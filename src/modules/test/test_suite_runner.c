#include "../serialization/consts.h"
#include "test_suite_runner.h"
#include "test_utils.h"

#define COMMA ,

#define NODE_EXPORATION_CASE(case_depth, case_expected_nodes_count) { .depth = case_depth COMMA .expected_nodes_count = case_expected_nodes_count##ULL }COMMA

#define DEFINE_NODE_EXPLORATION_BATCH(id, name, fen, cases_count, cases)    \
static char *s_##id##_name = name;                                          \
static char *s_##id##_fen = fen;                                            \
static uint32_t s_##id##_cases_count = cases_count;                         \
static node_exploration_case s_##id##_cases[] = cases;

#define RUN_NODE_EXPLORATION_BATCH(id) run_node_exploration_batch(s_##id##_name, s_##id##_fen, s_##id##_cases, s_##id##_cases_count);

DEFINE_NODE_EXPLORATION_BATCH(init, "INIT_POS", START_FEN_STR, 7,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 20)
    NODE_EXPORATION_CASE(2, 400)
    NODE_EXPORATION_CASE(3, 8902)
    NODE_EXPORATION_CASE(4, 197281)
    NODE_EXPORATION_CASE(5, 4865609)
    NODE_EXPORATION_CASE(6, 119060324)
})

DEFINE_NODE_EXPLORATION_BATCH(cust00, "CUSTOM_POS_00", "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 44)
    NODE_EXPORATION_CASE(2, 1486)
    NODE_EXPORATION_CASE(3, 62379)
    NODE_EXPORATION_CASE(4, 2103487)
    NODE_EXPORATION_CASE(5, 89941194)
})

DEFINE_NODE_EXPLORATION_BATCH(cust01, "CUSTOM_POS_01", "r6r/1b2k1bq/8/8/7B/8/8/R3K2R b KQ - 3 2", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 8)
    NODE_EXPORATION_CASE(2, 192)
    NODE_EXPORATION_CASE(3, 8355)
    NODE_EXPORATION_CASE(4, 206081)
    NODE_EXPORATION_CASE(5, 9296387)
})

DEFINE_NODE_EXPLORATION_BATCH(cust02, "CUSTOM_POS_02", "8/8/8/2k5/2pP4/8/B7/4K3 b - d3 0 3", 9,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 8)
    NODE_EXPORATION_CASE(2, 72)
    NODE_EXPORATION_CASE(3, 492)
    NODE_EXPORATION_CASE(4, 5380)
    NODE_EXPORATION_CASE(5, 36744)
    NODE_EXPORATION_CASE(6, 444954)
    NODE_EXPORATION_CASE(7, 3039234)
    NODE_EXPORATION_CASE(8, 39213236)
})

DEFINE_NODE_EXPLORATION_BATCH(cust03, "CUSTOM_POS_03", "r3k2r/p1pp1pb1/bn2Qnp1/2qPN3/1p2P3/2N5/PPPBBPPP/R3K2R b KQkq - 3 2", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 5)
    NODE_EXPORATION_CASE(2, 259)
    NODE_EXPORATION_CASE(3, 11766)
    NODE_EXPORATION_CASE(4, 563603)
    NODE_EXPORATION_CASE(5, 24890051)
})

DEFINE_NODE_EXPLORATION_BATCH(cust04, "CUSTOM_POS_04", "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 46)
    NODE_EXPORATION_CASE(2, 2079)
    NODE_EXPORATION_CASE(3, 89890)
    NODE_EXPORATION_CASE(4, 3894594)
    NODE_EXPORATION_CASE(5, 164075551)
})

DEFINE_NODE_EXPLORATION_BATCH(cust05, "CUSTOM_POS_05", "3k4/3p4/8/K1P4r/8/8/8/8 b - - 0 1", 8,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 18)
    NODE_EXPORATION_CASE(2, 92)
    NODE_EXPORATION_CASE(3, 1670)
    NODE_EXPORATION_CASE(4, 10138)
    NODE_EXPORATION_CASE(5, 185429)
    NODE_EXPORATION_CASE(6, 1134888)
    NODE_EXPORATION_CASE(7, 20757544)
})

DEFINE_NODE_EXPLORATION_BATCH(cust06, "CUSTOM_POS_06", "r1bqkbnr/pppppppp/n7/8/8/P7/1PPPPPPP/RNBQKBNR w KQkq - 2 2", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 19)
    NODE_EXPORATION_CASE(2, 380)
    NODE_EXPORATION_CASE(3, 8163)
    NODE_EXPORATION_CASE(4, 182327)
    NODE_EXPORATION_CASE(5, 4364503)
})

DEFINE_NODE_EXPLORATION_BATCH(cust07, "CUSTOM_POS_07", "2kr3r/p1ppqpb1/bn2Qnp1/3PN3/1p2P3/2N5/PPPBBPPP/R3K2R b KQ - 3 2", 5,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 44)
    NODE_EXPORATION_CASE(2, 2385)
    NODE_EXPORATION_CASE(3, 99756)
    NODE_EXPORATION_CASE(4, 5144430)
})

DEFINE_NODE_EXPLORATION_BATCH(cust08, "CUSTOM_POS_08", "rnb2k1r/pp1Pbppp/2p5/q7/2B5/8/PPPQNnPP/RNB1K2R w KQ - 3 9", 5,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 39)
    NODE_EXPORATION_CASE(2, 1577)
    NODE_EXPORATION_CASE(3, 63647)
    NODE_EXPORATION_CASE(4, 2433142)
})

DEFINE_NODE_EXPLORATION_BATCH(cust09, "CUSTOM_POS_09", "2r5/3pk3/8/2P5/8/2K5/8/8 w - - 5 4", 8,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 9)
    NODE_EXPORATION_CASE(2, 163)
    NODE_EXPORATION_CASE(3, 1349)
    NODE_EXPORATION_CASE(4, 23718)
    NODE_EXPORATION_CASE(5, 177964)
    NODE_EXPORATION_CASE(6, 3245821)
    NODE_EXPORATION_CASE(7, 24053172)
})

DEFINE_NODE_EXPLORATION_BATCH(cust10, "CUSTOM_POS_10", "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 44)
    NODE_EXPORATION_CASE(2, 1486)
    NODE_EXPORATION_CASE(3, 62379)
    NODE_EXPORATION_CASE(4, 2103487)
    NODE_EXPORATION_CASE(5, 89941194)
})

DEFINE_NODE_EXPLORATION_BATCH(cust11, "CUSTOM_POS_11", "8/8/4k3/8/2p5/8/B2P2K1/8 w - - 0 1", 8,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 13)
    NODE_EXPORATION_CASE(2, 102)
    NODE_EXPORATION_CASE(3, 1266)
    NODE_EXPORATION_CASE(4, 10276)
    NODE_EXPORATION_CASE(5, 135655)
    NODE_EXPORATION_CASE(6, 1015133)
    NODE_EXPORATION_CASE(7, 14047573)
})

DEFINE_NODE_EXPLORATION_BATCH(cust12, "CUSTOM_POS_12", "8/8/1k6/2b5/2pP4/8/5K2/8 b - d3 0 1", 8,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 15)
    NODE_EXPORATION_CASE(2, 126)
    NODE_EXPORATION_CASE(3, 1928)
    NODE_EXPORATION_CASE(4, 13931)
    NODE_EXPORATION_CASE(5, 206379)
    NODE_EXPORATION_CASE(6, 1440467)
    NODE_EXPORATION_CASE(7, 21190412)
})

DEFINE_NODE_EXPLORATION_BATCH(cust13, "CUSTOM_POS_13", "5k2/8/8/8/8/8/8/4K2R w K - 0 1", 9,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 15)
    NODE_EXPORATION_CASE(2, 66)
    NODE_EXPORATION_CASE(3, 1198)
    NODE_EXPORATION_CASE(4, 6399)
    NODE_EXPORATION_CASE(5, 120330)
    NODE_EXPORATION_CASE(6, 661072)
    NODE_EXPORATION_CASE(7, 12762196)
    NODE_EXPORATION_CASE(8, 73450134)
})

DEFINE_NODE_EXPLORATION_BATCH(cust14, "CUSTOM_POS_14", "3k4/8/8/8/8/8/8/R3K3 w Q - 0 1", 9,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 16)
    NODE_EXPORATION_CASE(2, 71)
    NODE_EXPORATION_CASE(3, 1286)
    NODE_EXPORATION_CASE(4, 7418)
    NODE_EXPORATION_CASE(5, 141077)
    NODE_EXPORATION_CASE(6, 803711)
    NODE_EXPORATION_CASE(7, 15594314)
    NODE_EXPORATION_CASE(8, 91628014)
})

DEFINE_NODE_EXPLORATION_BATCH(cust15, "CUSTOM_POS_15", "r3k2r/1b4bq/8/8/8/8/7B/R3K2R w KQkq - 0 1", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 26)
    NODE_EXPORATION_CASE(2, 1141)
    NODE_EXPORATION_CASE(3, 27826)
    NODE_EXPORATION_CASE(4, 1274206)
    NODE_EXPORATION_CASE(5, 31912360)
})

DEFINE_NODE_EXPLORATION_BATCH(cust16, "CUSTOM_POS_16", "r3k2r/8/3Q4/8/8/5q2/8/R3K2R b KQkq - 0 1", 6,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 44)
    NODE_EXPORATION_CASE(2, 1494)
    NODE_EXPORATION_CASE(3, 50509)
    NODE_EXPORATION_CASE(4, 1720476)
    NODE_EXPORATION_CASE(5, 58773923)
})

DEFINE_NODE_EXPLORATION_BATCH(cust17, "CUSTOM_POS_17", "2K2r2/4P3/8/8/8/8/8/3k4 w - - 0 1", 8,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 11)
    NODE_EXPORATION_CASE(2, 133)
    NODE_EXPORATION_CASE(3, 1442)
    NODE_EXPORATION_CASE(4, 19174)
    NODE_EXPORATION_CASE(5, 266199)
    NODE_EXPORATION_CASE(6, 3821001)
    NODE_EXPORATION_CASE(7, 60651209)
})

DEFINE_NODE_EXPLORATION_BATCH(cust18, "CUSTOM_POS_18", "8/8/1P2K3/8/2n5/1q6/8/5k2 b - - 0 1", 7,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 29)
    NODE_EXPORATION_CASE(2, 165)
    NODE_EXPORATION_CASE(3, 5160)
    NODE_EXPORATION_CASE(4, 31961)
    NODE_EXPORATION_CASE(5, 1004658)
    NODE_EXPORATION_CASE(6, 6334638)
})

DEFINE_NODE_EXPLORATION_BATCH(cust19, "CUSTOM_POS_19", "4k3/1P6/8/8/8/8/K7/8 w - - 0 1", 9,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 9)
    NODE_EXPORATION_CASE(2, 40)
    NODE_EXPORATION_CASE(3, 472)
    NODE_EXPORATION_CASE(4, 2661)
    NODE_EXPORATION_CASE(5, 38983)
    NODE_EXPORATION_CASE(6, 217342)
    NODE_EXPORATION_CASE(7, 3742283)
    NODE_EXPORATION_CASE(8, 20625698)
})

DEFINE_NODE_EXPLORATION_BATCH(cust20, "CUSTOM_POS_20", "8/P1k5/K7/8/8/8/8/8 w - - 0 1", 9,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 6)
    NODE_EXPORATION_CASE(2, 27)
    NODE_EXPORATION_CASE(3, 273)
    NODE_EXPORATION_CASE(4, 1329)
    NODE_EXPORATION_CASE(5, 18135)
    NODE_EXPORATION_CASE(6, 92683)
    NODE_EXPORATION_CASE(7, 1555980)
    NODE_EXPORATION_CASE(8, 8110830)
})

DEFINE_NODE_EXPLORATION_BATCH(cust21, "CUSTOM_POS_21", "K1k5/8/P7/8/8/8/8/8 w - - 0 1", 12,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 2)
    NODE_EXPORATION_CASE(2, 6)
    NODE_EXPORATION_CASE(3, 13)
    NODE_EXPORATION_CASE(4, 63)
    NODE_EXPORATION_CASE(5, 382)
    NODE_EXPORATION_CASE(6, 2217)
    NODE_EXPORATION_CASE(7, 15453)
    NODE_EXPORATION_CASE(8, 93446)
    NODE_EXPORATION_CASE(9, 998319)
    NODE_EXPORATION_CASE(10, 5966690)
    NODE_EXPORATION_CASE(11, 85822924)
})

DEFINE_NODE_EXPLORATION_BATCH(cust22, "CUSTOM_POS_22", "8/k1P5/8/1K6/8/8/8/8 w - - 0 1", 10,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 10)
    NODE_EXPORATION_CASE(2, 25)
    NODE_EXPORATION_CASE(3, 268)
    NODE_EXPORATION_CASE(4, 926)
    NODE_EXPORATION_CASE(5, 10857)
    NODE_EXPORATION_CASE(6, 43261)
    NODE_EXPORATION_CASE(7, 567584)
    NODE_EXPORATION_CASE(8, 2518905)
    NODE_EXPORATION_CASE(9, 37109897)
})

DEFINE_NODE_EXPLORATION_BATCH(cust23, "CUSTOM_POS_23", "8/8/2k5/5q2/5n2/8/5K2/8 b - - 0 1", 7,
{
    NODE_EXPORATION_CASE(0, 1)
    NODE_EXPORATION_CASE(1, 37)
    NODE_EXPORATION_CASE(2, 183)
    NODE_EXPORATION_CASE(3, 6559)
    NODE_EXPORATION_CASE(4, 23527)
    NODE_EXPORATION_CASE(5, 811573)
    NODE_EXPORATION_CASE(6, 3114998)
})

void run_node_exploration_test_suite()
{
    RUN_NODE_EXPLORATION_BATCH(init)
    RUN_NODE_EXPLORATION_BATCH(cust00)
    RUN_NODE_EXPLORATION_BATCH(cust01)
    RUN_NODE_EXPLORATION_BATCH(cust02)
    RUN_NODE_EXPLORATION_BATCH(cust03)
    RUN_NODE_EXPLORATION_BATCH(cust04)
    RUN_NODE_EXPLORATION_BATCH(cust05)
    RUN_NODE_EXPLORATION_BATCH(cust06)
    RUN_NODE_EXPLORATION_BATCH(cust07)
    RUN_NODE_EXPLORATION_BATCH(cust08)
    RUN_NODE_EXPLORATION_BATCH(cust09)
    RUN_NODE_EXPLORATION_BATCH(cust10)
    RUN_NODE_EXPLORATION_BATCH(cust11)
    RUN_NODE_EXPLORATION_BATCH(cust12)
    RUN_NODE_EXPLORATION_BATCH(cust13)
    RUN_NODE_EXPLORATION_BATCH(cust14)
    RUN_NODE_EXPLORATION_BATCH(cust15)
    RUN_NODE_EXPLORATION_BATCH(cust16)
    RUN_NODE_EXPLORATION_BATCH(cust17)
    RUN_NODE_EXPLORATION_BATCH(cust18)
    RUN_NODE_EXPLORATION_BATCH(cust19)
    RUN_NODE_EXPLORATION_BATCH(cust20)
    RUN_NODE_EXPLORATION_BATCH(cust21)
    RUN_NODE_EXPLORATION_BATCH(cust22)
    RUN_NODE_EXPLORATION_BATCH(cust23)
}

static void __remove_unused_macro_warnings()
{
    RUN_NODE_EXPLORATION_BATCH(init)
    RUN_NODE_EXPLORATION_BATCH(cust00)
    RUN_NODE_EXPLORATION_BATCH(cust01)
    RUN_NODE_EXPLORATION_BATCH(cust02)
    RUN_NODE_EXPLORATION_BATCH(cust03)
    RUN_NODE_EXPLORATION_BATCH(cust04)
    RUN_NODE_EXPLORATION_BATCH(cust05)
    RUN_NODE_EXPLORATION_BATCH(cust06)
    RUN_NODE_EXPLORATION_BATCH(cust07)
    RUN_NODE_EXPLORATION_BATCH(cust08)
    RUN_NODE_EXPLORATION_BATCH(cust09)
    RUN_NODE_EXPLORATION_BATCH(cust10)
    RUN_NODE_EXPLORATION_BATCH(cust11)
    RUN_NODE_EXPLORATION_BATCH(cust12)
    RUN_NODE_EXPLORATION_BATCH(cust13)
    RUN_NODE_EXPLORATION_BATCH(cust14)
    RUN_NODE_EXPLORATION_BATCH(cust15)
    RUN_NODE_EXPLORATION_BATCH(cust16)
    RUN_NODE_EXPLORATION_BATCH(cust17)
    RUN_NODE_EXPLORATION_BATCH(cust18)
    RUN_NODE_EXPLORATION_BATCH(cust19)
    RUN_NODE_EXPLORATION_BATCH(cust20)
    RUN_NODE_EXPLORATION_BATCH(cust21)
    RUN_NODE_EXPLORATION_BATCH(cust22)
    RUN_NODE_EXPLORATION_BATCH(cust23)
}